var Renderer=L.Canvas.extend({options:{collisionFlg:!0},initialize:function(t){t=L.Util.setOptions(this,t),L.Util.stamp(this),this._layers=this._layers||{}},_handleMouseHover:function(t,e){var i,a;for(i in this._drawnLayers)(a=this._drawnLayers[i]).options.interactive&&a._containsPoint(e)&&(L.DomUtil.addClass(this._containerText,"leaflet-interactive"),this._fireEvent([a],t,"mouseover"),this._hoveredLayer=a);this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_handleMouseOut:function(t,e){var i=this._hoveredLayer;i&&("mouseout"===t.type||!i._containsPoint(e))&&(L.DomUtil.removeClass(this._containerText,"leaflet-interactive"),this._fireEvent([i],t,"mouseout"),this._hoveredLayer=null)},_updateTransform:function(t,e){L.Canvas.prototype._updateTransform.call(this,t,e);var i=this._map.getZoomScale(e,this._zoom),a=L.DomUtil.getPosition(this._container),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,e),n=this._map.project(t,e).subtract(o),s=r.multiplyBy(-i).add(a).add(r).subtract(n);L.Browser.any3d?L.DomUtil.setTransform(this._containerText,s,i):L.DomUtil.setPosition(this._containerText,s)},_initContainer:function(t){L.Canvas.prototype._initContainer.call(this),this._containerText=document.createElement("canvas"),L.DomEvent.on(this._containerText,"mousemove",L.Util.throttle(this._onMouseMove,32,this),this).on(this._containerText,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(this._containerText,"mouseout",this._handleMouseOut,this),this._ctxLabel=this._containerText.getContext("2d"),L.DomUtil.addClass(this._containerText,"leaflet-zoom-animated"),this.getPane().appendChild(this._containerText)},_update:function(){this._textList=[],L.Renderer.prototype._update.call(this);var t=this._bounds,e=this._containerText,i=t.getSize(),a=L.Browser.retina?2:1;L.DomUtil.setPosition(e,t.min),e.width=a*i.x,e.height=a*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",e.style.zIndex="4",this._container.style.zIndex="3",L.Browser.retina&&this._ctxLabel.scale(2,2),this._ctxLabel.translate(-t.min.x,-t.min.y),L.Canvas.prototype._update.call(this)},_updatePoly:function(t,e){L.Canvas.prototype._updatePoly.call(this,t,e),this._text(this._ctxLabel,t)},_updateCircle:function(t){L.Canvas.prototype._updateCircle.call(this,t),this._text(this._ctxLabel,t)},_updateSector:function(t){if(!(!this._drawing||t._empty())){var e=t._point,i=this._ctx,a=t._startAngle/180*Math.PI,r=t._endAngle/180*Math.PI,o=Math.max(Math.round(t._radius),1),n=(Math.max(Math.round(t._radiusY),1)||o)/o;1!==n&&(i.save(),i.scale(1,n)),i.beginPath(),i.moveTo(e.x,e.y/n),i.arc(e.x,e.y/n,o,a,r,!1),i.closePath(),1!==n&&i.restore();var s=i.createRadialGradient(e.x,e.y/n,0,e.x,e.y/n,o);s.addColorStop(0,"rgb(0,0,255)"),s.addColorStop(1,"rgb(255,255,0)"),t.options.fillColor=s,this._fillStroke(i,t)}},_text:function(t,e){if(void 0!=e.options.text&&this._map.getZoom()>14){t.globalAlpha=1;var i=e._point;if(void 0==i){if(0==e._parts.length||0==e._parts[0].length)return;i=this._getCenter(e._parts[0])}t.lineWidth=4,t.font="12px 'Meiryo'";var a=t.measureText(e.options.text).width+i.x,r=i.y+5+20,o=L.bounds(L.point(i.x+7,i.y+5),L.point(a,r));if(this.options.collisionFlg){for(var n in this._textList)if(this._textList[n].intersects(o))return}this._textList.push(o),this._drawBubble(t,i.x,i.y,t.measureText(e.options.text).width+10,20),void 0==e.options.textColor?t.fillStyle="blue":t.fillStyle=e.options.textColor,t.fillText(e.options.text,i.x+7,i.y+5)}},_drawBubble:function(t,e,i,a,r){t.fillStyle="rgba(212,212,212,.8)",t.beginPath(),t.moveTo(e,i),t.lineTo(e+3,i+3),t.lineTo(e+3,i+r/2),t.lineTo(e+a,i+r/2),t.lineTo(e+a,i-r/2),t.lineTo(e+3,i-r/2),t.lineTo(e+3,i),t.fill()},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i,a=t.options.dashArray.split(/[, ]+/),r=[];for(i=0;i<a.length;i++){if(isNaN(e=Number(a[i])))return;r.push(e)}t.options._dashArray=r,t.options._dashOffset=t.options.dashOffset}else t.options._dashArray=t.options.dashArray,t.options._dashOffset=t.options.dashOffset||0},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&(t.setLineDash(e.options&&e.options._dashArray||[]),t.lineDashOffset=e.options&&e.options._dashOffset||0),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_getCenter:function(t){var e,i,a,r,o,n,s,l=t.length;if(!l)return null;for(e=0,i=0;e<l-1;e++)i+=t[e].distanceTo(t[e+1])/2;if(0===i)return t[0];for(e=0,r=0;e<l-1;e++)if(o=t[e],n=t[e+1],(r+=a=o.distanceTo(n))>i){s=(r-i)/a;var h=[n.x-s*(n.x-o.x),n.y-s*(n.y-o.y)];return L.point(h[0],h[1])}}}),Sector=L.Circle.extend({options:{renderer:new Renderer},initialize:function(t,e,i){e&&(this._startAngle=e.startAngle-90,this._endAngle=e.endAngle-90,L.Circle.prototype.initialize.call(this,t,e,i))},_updatePath:function(){(this._endAngle-this._startAngle)%360==0?this._renderer._updateCircle(this):this._renderer._updateSector(this)},setStyle:function(t){this._startAngle=t.startAngle-90,this._endAngle=t.endAngle-90,L.Circle.prototype.setStyle.call(this,t)}});L.Radar=L.LayerGroup.extend({options:{online:{color:"#dd2",dashArray:[5,15],weight:1,opacity:1,fillColor:"#d21",fillOpacity:.01},animat:{color:"#238",weight:0,opacity:0,fillColor:"#ff0",fillOpacity:.05,pmIgnore:!0},step:1},initialize:function(t,e){L.setOptions(this,e),this.map=null,this.mark=null,this.center=null,this.RadarArea=null,this.deviceObj=t,this.startR=0,this.reshArea(),L.LayerGroup.prototype.initialize.call(this,[])},getStyle(){return this.options.online},reshArea(){this.initCenter(),this._initSector()},_initSector(){if(null==this.RadarArea)this.RadarArea=this.creatSector();else{var t=this.getSectorOptions();this.RadarArea.setStyle(t),this.RadarArea.setLatLng(L.latLng(this.center))}if(null==this.animationRadarArea)this.animationRadarArea=this.creatSector(this.getSectorStyle());else{var t=this.getSectorOptions(this.getSectorStyle());this.animationRadarArea.setStyle(t),this.animationRadarArea.setLatLng(L.latLng(this.center))}},getSectorStyle(){return this.options.animat},creatSector(t){if(!this.center)return!1;var e=this.getSectorOptions(t);if(e)return new Sector(this.center,e)},_motion:function(){var t=this,e=this.options.step;t.startR+=e,t.startR>t.deviceObj.radius&&(t.startR=0),t.animationRadarArea.setRadius(t.startR),t.animation=L.Util.requestAnimFrame(function(){t._motion()},t)},getSectorOptions(t){if(0==this.deviceObj.angle)return null;var e=this.deviceObj.direction-this.deviceObj.angle/2,i=this.deviceObj.direction+this.deviceObj.angle/2;if(!t)var t=this.getStyle();return t=Object.assign(t,{startAngle:e,endAngle:i,radius:this.deviceObj.radius})},initCenter(){if(this.deviceObj.location){var t=this.deviceObj.location.split(" ");if(parseFloat(t[0])>-90&&90>parseFloat(t[0])&&parseFloat(t[1])>-180&&180>parseFloat(t[1]))this.center=[parseFloat(t[0]),parseFloat(t[1])];else{this.center=null,console.error("Invalid coordinates");return}}},update:function(t){this.deviceObj.radius=t.radius,this.deviceObj.angle=t.angle,this.deviceObj.direction=t.direction,t.location&&(this.deviceObj.location=t.location),this.reshArea()},adjust:function(t){t&&(this.deviceObj.location=t,this.reshArea())},move:function(t){var e=this.deviceObj.location.split(" "),i=[parseFloat(e[0]),parseFloat(e[1])];i[0]+=t[0],i[1]+=t[1],this.deviceObj.location=i.join(" "),this.reshArea()},toggleRadarAnimate:function(t){this.RadarArea&&(t?this.map.hasLayer(this.animationRadarArea)||L.LayerGroup.prototype.addLayer.call(this,this.animationRadarArea):L.LayerGroup.prototype.removeLayer.call(this,this.animationRadarArea))},toggleRadarArea:function(t){t?this.map.hasLayer(this.RadarArea)||(this.RadarArea&&L.LayerGroup.prototype.addLayer.call(this,this.RadarArea),L.LayerGroup.prototype.addLayer.call(this,this.mark)):(L.LayerGroup.prototype.removeLayer.call(this,this.RadarArea),L.LayerGroup.prototype.addLayer.call(this,this.mark))},getConfg(){return this.deviceObj},onAdd:function(t){this.map=t,this.RadarArea&&L.LayerGroup.prototype.addLayer.call(this,this.RadarArea),this.mark&&L.LayerGroup.prototype.addLayer.call(this,this.mark),this.animationRadarArea&&(L.LayerGroup.prototype.addLayer.call(this,this.animationRadarArea),this._motion())}});export default function(t,e){return new L.Radar(t,e)};